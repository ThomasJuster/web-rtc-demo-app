{"version":3,"sources":["webpack:///./src/views/Session.vue?0e46","webpack:///./src/views/Session.vue?fdd5","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///./src/web-rtc/PeerConnection.ts","webpack:///./src/web-rtc/PeersManager.ts","webpack:///src/views/Session.vue","webpack:///./src/views/Session.vue?a977","webpack:///./src/views/Session.vue?f251"],"names":["render","_vm","this","_h","$createElement","_c","_self","_v","_s","$route","params","query","serverUrl","_e","attrs","on","$event","$router","replace","scopedSlots","_u","key","fn","proxy","error","undefined","message","stack","unableToReachServer","canJoinSession","isLocalPeerSetupReady","sessionName","ref","domProps","staticStyle","_l","peersManager","peerConnections","keys","remotePeerId","refInFor","askLocalStream","localStream","finishInitialSetup","staticRenderFns","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","ICE_SERVERS","urls","username","credential","localPeerId","socketAPI","connection","RTCPeerConnection","iceServers","remoteStream","remotePeerVideo","getTracks","map","track","addTrack","registerICECandidatesListener","addEventListener","event","streams","srcObject","onClose","listener","console","debug","connectionState","registerVideo","video","candidate","send","type","fromPeerId","toPeerId","onIceCandidate","data","addIceCandidate","RTCIceCandidate","catch","iceConnectionState","RTC_OFFER_OPTIONS","Map","offerToReceiveAudio","offerToReceiveVideo","voiceActivityDetection","onConnectedPeers","socketMessage","onOffer","onAnswer","getPeerConnection","peerConnection","get","Error","closeAllConnections","close","promises","peerIds","filter","peerId","PeerConnection","set","createOffer","offer","setLocalDescription","description","offererId","answererId","all","setRemoteDescription","createAnswer","answer","getRandomPeerId","id","Math","round","random","name","components","Modal","joinSessionLoading","password","serverAPI","url","URL","origin","info","joinSessionResult","joinSession","ok","methods","socketBaseUrl","protocol","window","location","href","localPeer","$nextTick","registerRemotePeersVideo","$refs","$watch","forEach","mediaTrackConstraints","echoCancellation","noiseSuppression","navigator","mediaDevices","getUserMedia","audio","component"],"mappings":"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","file":"js/session.0fac76ae.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Session.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Session.vue?vue&type=style&index=0&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('main',[_c('h1',[_vm._v(_vm._s((\"Session \" + (_vm.$route.params.sessionName))))]),(!_vm.$route.query.serverUrl)?_c('Modal',{attrs:{\"fixed\":\"\",\"open\":\"\"},on:{\"close\":function($event){return _vm.$router.replace('/')}},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('h3',[_vm._v(_vm._s('Error !'))])]},proxy:true}],null,false,2136969466)},[_c('p',[_vm._v(_vm._s('A server URL is required.'))])]):_vm._e(),_c('Modal',{attrs:{\"fixed\":\"\",\"open\":!!_vm.error},on:{\"close\":function($event){_vm.error = undefined}},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('h3',[_vm._v(_vm._s('An unknown error occurred'))])]},proxy:true}])},[_c('p',[_vm._v(_vm._s('This is the error'))]),(_vm.error)?_c('pre',[_vm._v(\"      \"+_vm._s(_vm.error.message)+\"\\n      \"+_vm._s(_vm.error.stack)+\"\\n    \")]):_vm._e()]),_c('Modal',{attrs:{\"fixed\":\"\",\"open\":_vm.unableToReachServer},on:{\"close\":function($event){_vm.unableToReachServer = undefined}},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('h3',[_vm._v(\"Oopsie…\")])]},proxy:true}])},[_c('p',[_vm._v(\"Looks like the server is taking a nap, we can’t reach it…\")])]),(!_vm.canJoinSession)?_c('div',[_c('h3',[_vm._v(\"Let’s initialize that session dude.\")]),(_vm.joinSessionLoading)?_c('div',[_vm._v(\" Joining the session… \")]):_vm._e(),_c('Modal',{attrs:{\"fixed\":\"\",\"open\":_vm.canJoinSession === false},on:{\"close\":function($event){return _vm.$router.replace('/')}},scopedSlots:_vm._u([{key:\"header\",fn:function(){return [_c('h3',[_vm._v(\"Aïe aïe aïe\")])]},proxy:true}],null,false,3527552773)},[_c('p',[_vm._v(\" You cannot join this session. Either this session does not exist, either the URL you were given is wrong. \")])])],1):(!_vm.isLocalPeerSetupReady)?_c('div',[_c('ul',{staticStyle:{\"text-align\":\"left\",\"line-height\":\"2.5em\"}},[_c('h3',{staticStyle:{\"margin\":\"0\"}},[_vm._v(\"Before joining the session:\")]),_c('li',[_vm._v(\"Accept sharing your audio & video with this us.\")]),_c('li',[_vm._v(\"Check out your video (below) to see if everything is OK.\")]),_c('li',[_vm._v(\"If necessary, you can \"),_c('button',{on:{\"click\":_vm.askLocalStream}},[_vm._v(\"Re-ask to get your audio & video\")])])]),_c('div',[_c('video',{key:\"local-peer-video\",ref:\"test-video\",attrs:{\"playsinline\":\"\",\"autoplay\":\"\",\"muted\":\"\"},domProps:{\"muted\":true}})]),_c('div',{staticStyle:{\"padding\":\"2em 0\"}},[_c('button',{attrs:{\"disabled\":!_vm.localStream},on:{\"click\":_vm.finishInitialSetup}},[_vm._v(\"Let’s go to that conference call\")])])]):_c('div',[_c('h3',[_vm._v(\"Conference \"+_vm._s(_vm.$route.params.sessionName))]),_c('video',{key:\"local-peer-video\",ref:\"local-peer-video\",attrs:{\"playsinline\":\"\",\"autoplay\":\"\",\"muted\":\"\"},domProps:{\"muted\":true}}),(_vm.peersManager)?_c('span',{staticStyle:{\"display\":\"inline-block\"}},_vm._l((_vm.peersManager.peerConnections.keys()),function(remotePeerId){return _c('video',{key:remotePeerId,ref:remotePeerId,refInFor:true,attrs:{\"playsinline\":\"\",\"autoplay\":\"\"}})}),0):_vm._e()])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { SocketAPI } from '@web-rtc-demo/shared'\n\nconst ICE_SERVERS: RTCIceServer[] = [\n  // { urls: 'stun:stunserver.org:3478' },\n  { urls: 'stun:stun.stunprotocol.org:3478' },\n  { urls: 'turn:137.74.113.202:3478', username: 'azfne', credential: 'oegiojre' },\n]\n\ntype PeerConnectionListener = (event: Event) => unknown\n\ninterface PeerConnectionInit {\n  localPeerId: string;\n  remotePeerId: string;\n  localStream: MediaStream;\n  socketAPI: SocketAPI;\n}\n// NOTE: A connection involves two peers, the local peer and the remote one.\nexport class PeerConnection {\n  public connection: RTCPeerConnection\n  public localPeerId: string\n  public remotePeerId: string\n  private remoteStream: MediaStream | null;\n  private remotePeerVideo: HTMLVideoElement | null;\n  private socketAPI: SocketAPI\n\n  constructor (params: PeerConnectionInit) {\n    this.localPeerId = params.localPeerId\n    this.remotePeerId = params.remotePeerId\n    this.socketAPI = params.socketAPI\n    this.connection = new RTCPeerConnection({ iceServers: ICE_SERVERS })\n    this.remoteStream = null\n    this.remotePeerVideo = null\n\n    params.localStream.getTracks().map((track) => this.connection.addTrack(track, params.localStream))\n    this.registerICECandidatesListener()\n\n    this.connection.addEventListener('track', (event) => {\n      [this.remoteStream] = event.streams\n      if (this.remotePeerVideo) this.remotePeerVideo.srcObject = this.remoteStream\n    })\n  }\n\n  public onClose (listener: PeerConnectionListener): PeerConnection {\n    this.connection.addEventListener('connectionstatechange', (event) => {\n      console.debug('connection state change', event, 'connection state:', this.connection.connectionState)\n      switch (this.connection.connectionState) {\n        case 'closed':\n        case 'disconnected':\n        case 'failed':\n          listener(event)\n          break\n        default:\n          break\n      }\n    })\n    return this\n  }\n\n  public registerVideo (video: HTMLVideoElement): PeerConnection {\n    this.remotePeerVideo = video\n    if (this.remoteStream) this.remotePeerVideo.srcObject = this.remoteStream\n    return this\n  }\n\n  private registerICECandidatesListener (): PeerConnection {\n    // NOTE: the icecandidate event is trigger AFTER creating an offer/answer.\n    // As soon as we have the local peer’s ice candidates, we send them to the remote peer so that\n    // both peers add the ICE candidates of the other peer.\n    this.connection.addEventListener('icecandidate', (event) => {\n      if (!event.candidate) return\n      console.debug('emit ICE candidate to', this.remotePeerId, event.candidate)\n      this.socketAPI.send({\n        type: 'ice-candidate',\n        candidate: event.candidate,\n        fromPeerId: this.localPeerId,\n        toPeerId: this.remotePeerId,\n      })\n    })\n\n    // when receiving a remote peer’s ICE candidates, we can add them to the PeerConnection to make the connection effective\n    // without ICE candidates, the connection would exist but it’d be useless, it’s ICE candidates that allow exchanging data\n    this.socketAPI.onIceCandidate((data) => {\n      if (data.type !== 'ice-candidate') return\n      console.debug(this.localPeerId, 'receive ice candidate from', data.fromPeerId, data.candidate)\n      this.connection.addIceCandidate(new RTCIceCandidate(data.candidate)).catch(console.error)\n    })\n\n    this.connection.addEventListener('iceconnectionstatechange', (event) => {\n      console.debug('ice connection state change', event, this.connection.iceConnectionState)\n    })\n\n    return this\n  }\n}\n","import { SocketAPI, SocketMessage } from '@web-rtc-demo/shared'\nimport { PeerConnection } from './PeerConnection'\n\ntype PeerId = string\n\nexport const connectedPeers: Map<PeerId, PeerConnection> = new Map()\n\nconst RTC_OFFER_OPTIONS: RTCOfferOptions = {\n  offerToReceiveAudio: true,\n  offerToReceiveVideo: true,\n  voiceActivityDetection: true,\n}\n\ninterface PeersInit {\n  socketAPI: SocketAPI;\n  localPeerId: string;\n  localStream: MediaStream;\n}\nexport class PeersManager {\n  public peerConnections: Map<PeerId, PeerConnection>\n  private localPeerId: string\n  private localStream: MediaStream\n  private socketAPI: SocketAPI\n\n  constructor ({ socketAPI, localPeerId, localStream }: PeersInit) {\n    this.socketAPI = socketAPI\n    this.localPeerId = localPeerId\n    this.localStream = localStream\n    this.peerConnections = new Map()\n\n    socketAPI.onConnectedPeers((socketMessage) => this.onConnectedPeers(socketMessage))\n    socketAPI.onOffer((socketMessage) => this.onOffer(socketMessage))\n    socketAPI.onAnswer((socketMessage) => this.onAnswer(socketMessage))\n  }\n\n  public getPeerConnection (remotePeerId: string): PeerConnection {\n    const peerConnection = this.peerConnections.get(remotePeerId)\n    if (!peerConnection) throw new Error(`No peer connection with remote peer ${remotePeerId}`)\n    return peerConnection\n  }\n\n  public closeAllConnections () {\n    this.socketAPI.close()\n  }\n\n  // When the local peer arrives on the session, it receives the current remote peers\n  // With that information, the local peer sends an offer to each remote peer\n  private onConnectedPeers (socketMessage: SocketMessage): void {\n    if (socketMessage.type !== 'connected-peers-id') throw new Error('Invalid connected peers message')\n\n    const promises = socketMessage.peerIds\n      .filter((peerId) => peerId !== this.localPeerId)\n      .map(async (remotePeerId) => {\n        // Create the connection object\n        const peerConnection = new PeerConnection({\n          localPeerId: this.localPeerId,\n          remotePeerId,\n          localStream: this.localStream,\n          socketAPI: this.socketAPI,\n        })\n        this.peerConnections.set(remotePeerId, peerConnection)\n\n        // Create an offer\n        const offer = await peerConnection.connection.createOffer(RTC_OFFER_OPTIONS)\n        await peerConnection.connection.setLocalDescription(offer)\n\n        // Send the offer to the remote peer\n        this.socketAPI.send({\n          type: 'offer',\n          description: offer,\n          offererId: this.localPeerId,\n          answererId: remotePeerId,\n        })\n      })\n    Promise.all(promises).catch(console.error)\n  }\n\n  // When receiving an offer, the local peer should accept the offer by sending an answer back to the remote peer\n  private async onOffer (socketMessage: SocketMessage): Promise<void> {\n    if (socketMessage.type !== 'offer') throw new Error('Invalid offer socket message')\n\n    const peerConnection = this.getPeerConnection(socketMessage.offererId)\n\n    // create the answer, apply it to the peer connection\n    await peerConnection.connection.setRemoteDescription(socketMessage.description)\n    const answer = await peerConnection.connection.createAnswer(RTC_OFFER_OPTIONS)\n    await peerConnection.connection.setLocalDescription(answer)\n\n    // send the answer to the remote peer\n    this.socketAPI.send({\n      type: 'answer',\n      answererId: this.localPeerId,\n      offererId: socketMessage.offererId,\n      description: answer,\n    })\n  }\n\n  // when receiving an answer, the local peer should accept the remote peer’s and notify the remote peer s⋅he did accept the answer\n  private onAnswer (socketMessage: SocketMessage): void {\n    if (socketMessage.type !== 'answer') throw new Error('Invalid answer socket message')\n\n    const peerConnection = this.getPeerConnection(socketMessage.answererId)\n\n    // Accept the answer\n    peerConnection.connection.setRemoteDescription(socketMessage.description)\n  }\n}\n","<script>\nimport { SocketAPI, SOCKET_ROUTE, ServerAPI } from '@web-rtc-demo/shared'\nimport Modal from '../components/Modal.vue'\nimport { PeersManager } from '../web-rtc/PeersManager'\n\nfunction getRandomPeerId () {\n  const id = Math.round(Math.random() * 100000)\n  return `peer-${id}`\n}\n\nexport default {\n  name: 'Session',\n  components: {\n    Modal,\n  },\n  data: () => ({\n    joinSessionLoading: false,\n    canJoinSession: undefined,\n    unableToReachServer: undefined,\n    error: undefined,\n\n    isLocalPeerSetupReady: false,\n    localStream: null,\n    localPeerId: getRandomPeerId(), // must NOT be changed accross component lifetime\n\n    peersManager: null,\n  }),\n\n  async mounted () {\n    const { serverUrl, password } = this.$route.query\n    const serverAPI = new ServerAPI({ url: new URL(serverUrl).origin })\n\n    this.joinSessionLoading = true\n    console.info('local peer id', this.localPeerId)\n    try {\n      const joinSessionResult = await serverAPI.joinSession(this.$route.params.sessionName, password)\n      this.canJoinSession = joinSessionResult.ok\n    } catch (error) {\n      console.error(error)\n      this.unableToReachServer = true\n    }\n    this.joinSessionLoading = false\n    if (!this.canJoinSession || this.unableToReachServer) return\n\n    await this.askLocalStream()\n  },\n\n  errorCaptured (error) {\n    this.error = error\n  },\n\n  beforeDestroy () {\n    console.info('beforeDestroy()')\n    if (this.peersManager) {\n      this.peersManager.closeAllConnections()\n    }\n  },\n\n  methods: {\n    finishInitialSetup () {\n      this.isLocalPeerSetupReady = true\n      const { params: { sessionName }, query: { serverUrl } } = this.$route.params\n      const socketBaseUrl = new URL(serverUrl)\n      socketBaseUrl.protocol = window.location.protocol.replace('http', 'ws')\n      const url = SOCKET_ROUTE\n        .replace('{sessionName}', sessionName)\n        .replace('{peerId}', this.localPeerId)\n\n      this.peersManager = new PeersManager({\n        socketAPI: new SocketAPI({\n          url: new URL(url, socketBaseUrl).href,\n          sessionName: this.$route.params.sessionName,\n          peerId: this.localPeer,\n        }),\n        localPeerId: this.localPeerId,\n        localStream: this.localStream,\n      })\n      this.$nextTick(() => {\n        this.registerRemotePeersVideo()\n        this.$refs['local-peer-video'].srcObject = this.localStream\n      })\n      this.$watch('peersManager.size', () => {\n        this.$nextTick(() => this.registerRemotePeersVideo())\n      })\n    },\n\n    registerRemotePeersVideo () {\n      this.peersManager.peerConnections.forEach((peerConnection, remotePeerId) => {\n        peerConnection.registerVideo(this.$refs[remotePeerId])\n      })\n    },\n\n    async askLocalStream () {\n      const mediaTrackConstraints = {\n        echoCancellation: true,\n        noiseSuppression: true,\n      }\n      this.localStream = await window.navigator.mediaDevices.getUserMedia({\n        audio: mediaTrackConstraints,\n        video: mediaTrackConstraints,\n      })\n      this.$refs['test-video'].srcObject = this.localStream\n    },\n  },\n}\n</script>\n\n<template>\n  <main>\n    <h1>{{ `Session ${$route.params.sessionName}` }}</h1>\n\n    <Modal v-if=\"!$route.query.serverUrl\" fixed open v-on:close=\"$router.replace('/')\">\n      <template v-slot:header>\n        <h3>{{ 'Error !' }}</h3>\n      </template>\n      <p>{{ 'A server URL is required.' }}</p>\n    </Modal>\n\n    <Modal fixed :open=\"!!error\" v-on:close=\"error = undefined\">\n      <template v-slot:header>\n        <h3>{{ 'An unknown error occurred' }}</h3>\n      </template>\n      <p>{{ 'This is the error' }}</p>\n      <pre v-if=\"error\">\n        {{ error.message }}\n        {{ error.stack }}\n      </pre>\n    </Modal>\n\n    <Modal fixed :open=\"unableToReachServer\" v-on:close=\"unableToReachServer = undefined\">\n      <template v-slot:header>\n        <h3>Oopsie…</h3>\n      </template>\n      <p>Looks like the server is taking a nap, we can’t reach it…</p>\n    </Modal>\n\n    <div v-if=\"!canJoinSession\">\n      <h3>Let’s initialize that session dude.</h3>\n      <div v-if=\"joinSessionLoading\">\n        Joining the session…\n      </div>\n\n      <Modal fixed :open=\"canJoinSession === false\" v-on:close=\"$router.replace('/')\">\n        <template v-slot:header>\n          <h3>Aïe aïe aïe</h3>\n        </template>\n        <p>\n          You cannot join this session. Either this session does not exist, either the URL you were given is wrong.\n        </p>\n      </Modal>\n    </div>\n\n    <div v-else-if=\"!isLocalPeerSetupReady\">\n      <ul style=\"text-align: left; line-height: 2.5em;\">\n        <h3 style=\"margin: 0;\">Before joining the session:</h3>\n        <li>Accept sharing your audio &amp; video with this us.</li>\n        <li>Check out your video (below) to see if everything is OK.</li>\n        <li>If necessary, you can <button v-on:click=\"askLocalStream\">Re-ask to get your audio &amp; video</button></li>\n      </ul>\n      <div>\n        <video ref=\"test-video\" playsinline autoplay muted key=\"local-peer-video\"></video>\n      </div>\n      <div style=\"padding: 2em 0;\">\n        <button :disabled=\"!localStream\" v-on:click=\"finishInitialSetup\">Let’s go to that conference call</button>\n      </div>\n    </div>\n\n    <div v-else>\n      <h3>Conference {{ $route.params.sessionName }}</h3>\n      <video ref=\"local-peer-video\" playsinline autoplay muted key=\"local-peer-video\"></video>\n      <span style=\"display: inline-block;\" v-if=\"peersManager\">\n        <video\n          v-for=\"remotePeerId of peersManager.peerConnections.keys()\"\n          :key=\"remotePeerId\"\n          :ref=\"remotePeerId\"\n          playsinline\n          autoplay\n        ></video>\n      </span>\n    </div>\n  </main>\n</template>\n\n<style>\nvideo {\n  border-radius: 0.25em;\n  display: inline-block;\n  margin: 1em;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Session.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Session.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Session.vue?vue&type=template&id=70296a8b&\"\nimport script from \"./Session.vue?vue&type=script&lang=js&\"\nexport * from \"./Session.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Session.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}