(function(e){function t(t){for(var s,i,a=t[0],c=t[1],l=t[2],u=0,p=[];u<a.length;u++)i=a[u],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&p.push(n[i][0]),n[i]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);d&&d(t);while(p.length)p.shift()();return r.push.apply(r,l||[]),o()}function o(){for(var e,t=0;t<r.length;t++){for(var o=r[t],s=!0,a=1;a<o.length;a++){var c=o[a];0!==n[c]&&(s=!1)}s&&(r.splice(t--,1),e=i(i.s=o[0]))}return e}var s={},n={app:0},r=[];function i(t){if(s[t])return s[t].exports;var o=s[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=s,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(o,s,function(t){return e[t]}.bind(null,s));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/web-rtc-demo-app/dist/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;r.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("cd49")},"034f":function(e,t,o){"use strict";var s=o("85ec"),n=o.n(s);n.a},"0cf6":function(e,t,o){"use strict";var s=o("7086"),n=o.n(s);n.a},2154:function(e,t,o){"use strict";var s=o("ed34"),n=o.n(s);n.a},5654:function(e,t,o){},"62ca":function(e,t,o){"use strict";var s=o("90d1"),n=o.n(s);n.a},7086:function(e,t,o){},"714b":function(e,t,o){"use strict";var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return this.open?o("div",{staticClass:"modal",class:{"is-fixed":e.fixed}},[o("div",{staticClass:"backdrop",on:{click:function(t){return e.$emit("close")}}}),o("div",{staticClass:"dialog"},[o("header",{staticClass:"header"},[e._t("header"),o("span",{staticClass:"close-icon",on:{click:function(t){return e.$emit("close")}}},[e._t("close-icon",[e._v("×")])],2)],2),o("div",{staticClass:"content"},[e._t("default")],2),o("footer",{staticClass:"footer"},[e._t("footer",[o("button",{on:{click:function(t){return e.$emit("close")}}},[e._v("Close")])])],2)])]):e._e()},n=[],r={name:"Modal",props:{open:Boolean,fixed:{type:Boolean,default:!1}}},i=r,a=(o("62ca"),o("2877")),c=Object(a["a"])(i,s,n,!1,null,"4a83eccf",null);t["a"]=c.exports},"78b4":function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("main",[o("h1",[e._v(e._s("Session "+e.$route.params.sessionName))]),e.$route.query.serverUrl?e._e():o("Modal",{attrs:{fixed:"",open:""},on:{close:function(t){return e.$router.replace("/")}},scopedSlots:e._u([{key:"header",fn:function(){return[o("h3",[e._v(e._s("Error !"))])]},proxy:!0}],null,!1,2136969466)},[o("p",[e._v(e._s("A server URL is required."))])]),o("Modal",{attrs:{fixed:"",open:!!e.error},on:{close:function(t){e.error=void 0}},scopedSlots:e._u([{key:"header",fn:function(){return[o("h3",[e._v(e._s("An unknown error occurred"))])]},proxy:!0}])},[o("p",[e._v(e._s("This is the error"))]),e.error?o("pre",[e._v("      "+e._s(e.error.message)+"\n      "+e._s(e.error.stack)+"\n    ")]):e._e()]),o("Modal",{attrs:{fixed:"",open:e.unableToReachServer},on:{close:function(t){e.unableToReachServer=void 0}},scopedSlots:e._u([{key:"header",fn:function(){return[o("h3",[e._v("Oopsie…")])]},proxy:!0}])},[o("p",[e._v("Looks like the server is taking a nap, we can’t reach it…")])]),e.canJoinSession?e.isLocalPeerSetupReady?o("div",[o("h3",[e._v("Conference "+e._s(e.$route.params.sessionName))]),o("video",{key:"local-peer-video",ref:"local-peer-video",attrs:{playsinline:"",autoplay:"",muted:""},domProps:{muted:!0}}),e.peersManager?o("span",{staticStyle:{display:"inline-block"}},e._l(e.peersManager.peerConnections.keys(),(function(e){return o("video",{key:e,ref:e,refInFor:!0,attrs:{playsinline:"",autoplay:""}})})),0):e._e()]):o("div",[o("ul",{staticStyle:{"text-align":"left","line-height":"2.5em"}},[o("h3",{staticStyle:{margin:"0"}},[e._v("Before joining the session:")]),o("li",[e._v("Accept sharing your audio & video with this us.")]),o("li",[e._v("Check out your video (below) to see if everything is OK.")]),o("li",[e._v("If necessary, you can "),o("button",{on:{click:e.askLocalStream}},[e._v("Re-ask to get your audio & video")])])]),o("div",[o("video",{key:"local-peer-video",ref:"test-video",attrs:{playsinline:"",autoplay:"",muted:""},domProps:{muted:!0}})]),o("div",{staticStyle:{padding:"2em 0"}},[o("button",{attrs:{disabled:!e.localStream},on:{click:e.finishInitialSetup}},[e._v("Let’s go to that conference call")])])]):o("div",[o("h3",[e._v("Let’s initialize that session dude.")]),e.joinSessionLoading?o("div",[e._v(" Joining the session… ")]):e._e(),o("Modal",{attrs:{fixed:"",open:!1===e.canJoinSession},on:{close:function(t){return e.$router.replace("/")}},scopedSlots:e._u([{key:"header",fn:function(){return[o("h3",[e._v("Aïe aïe aïe")])]},proxy:!0}],null,!1,3527552773)},[o("p",[e._v(" You cannot join this session. Either this session does not exist, either the URL you were given is wrong. ")])])],1)],1)},n=[],r=o("12fd"),i=o("714b"),a=o("9ab4"),c=[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"turn:137.74.113.202:3478",username:"azfne",credential:"oegiojre"}],l=function(){function e(e){var t=this;this.localPeerId=e.localPeerId,this.remotePeerId=e.remotePeerId,this.socketAPI=e.socketAPI,this.connection=new RTCPeerConnection({iceServers:c}),this.remoteStream=null,this.remotePeerVideo=null,e.localStream.getTracks().map((function(o){return t.connection.addTrack(o,e.localStream)})),this.registerICECandidatesListener(),this.connection.addEventListener("track",(function(e){t.remoteStream=e.streams[0],t.remotePeerVideo&&(t.remotePeerVideo.srcObject=t.remoteStream)}))}return e.prototype.onClose=function(e){var t=this;return this.connection.addEventListener("connectionstatechange",(function(o){switch(console.debug("connection state change",o,"connection state:",t.connection.connectionState),t.connection.connectionState){case"closed":case"disconnected":case"failed":e(o);break;default:break}})),this},e.prototype.registerVideo=function(e){return this.remotePeerVideo=e,this.remoteStream&&(this.remotePeerVideo.srcObject=this.remoteStream),this},e.prototype.registerICECandidatesListener=function(){var e=this;return this.connection.addEventListener("icecandidate",(function(t){t.candidate&&(console.debug("emit ICE candidate to",e.remotePeerId,t.candidate),e.socketAPI.send({type:"ice-candidate",candidate:t.candidate,fromPeerId:e.localPeerId,toPeerId:e.remotePeerId}))})),this.socketAPI.onIceCandidate((function(t){"ice-candidate"===t.type&&(console.debug(e.localPeerId,"receive ice candidate from",t.fromPeerId,t.candidate),e.connection.addIceCandidate(new RTCIceCandidate(t.candidate)).catch(console.error))})),this.connection.addEventListener("iceconnectionstatechange",(function(t){console.debug("ice connection state change",t,e.connection.iceConnectionState)})),this},e}(),d=(new Map,{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!0}),u=function(){function e(e){var t=this,o=e.socketAPI,s=e.localPeerId,n=e.localStream;this.socketAPI=o,this.localPeerId=s,this.localStream=n,this.peerConnections=new Map,o.onConnectedPeers((function(e){return t.onConnectedPeers(e)})),o.onOffer((function(e){return t.onOffer(e)})),o.onAnswer((function(e){return t.onAnswer(e)}))}return e.prototype.getPeerConnection=function(e){var t=this.peerConnections.get(e);if(!t)throw new Error("No peer connection with remote peer "+e);return t},e.prototype.closeAllConnections=function(){this.socketAPI.close()},e.prototype.onConnectedPeers=function(e){var t=this;if("connected-peers-id"!==e.type)throw new Error("Invalid connected peers message");var o=e.peerIds.filter((function(e){return e!==t.localPeerId})).map((function(e){return Object(a["a"])(t,void 0,void 0,(function(){var t,o;return Object(a["b"])(this,(function(s){switch(s.label){case 0:return t=new l({localPeerId:this.localPeerId,remotePeerId:e,localStream:this.localStream,socketAPI:this.socketAPI}),this.peerConnections.set(e,t),[4,t.connection.createOffer(d)];case 1:return o=s.sent(),[4,t.connection.setLocalDescription(o)];case 2:return s.sent(),this.socketAPI.send({type:"offer",description:o,offererId:this.localPeerId,answererId:e}),[2]}}))}))}));Promise.all(o).catch(console.error)},e.prototype.onOffer=function(e){return Object(a["a"])(this,void 0,Promise,(function(){var t,o;return Object(a["b"])(this,(function(s){switch(s.label){case 0:if("offer"!==e.type)throw new Error("Invalid offer socket message");return t=this.getPeerConnection(e.offererId),[4,t.connection.setRemoteDescription(e.description)];case 1:return s.sent(),[4,t.connection.createAnswer(d)];case 2:return o=s.sent(),[4,t.connection.setLocalDescription(o)];case 3:return s.sent(),this.socketAPI.send({type:"answer",answererId:this.localPeerId,offererId:e.offererId,description:o}),[2]}}))}))},e.prototype.onAnswer=function(e){if("answer"!==e.type)throw new Error("Invalid answer socket message");var t=this.getPeerConnection(e.answererId);t.connection.setRemoteDescription(e.description)},e}();function p(){const e=Math.round(1e5*Math.random());return"peer-"+e}var h={name:"Session",components:{Modal:i["a"]},data:()=>({joinSessionLoading:!1,canJoinSession:void 0,unableToReachServer:void 0,error:void 0,isLocalPeerSetupReady:!1,localStream:null,localPeerId:p(),peersManager:null}),async mounted(){const{serverUrl:e,password:t,sessionName:o}=this.$route.query,s=new r["ServerAPI"]({url:new URL(e).origin});if("string"!==typeof o)throw new Error("sessionName should be a string");this.joinSessionLoading=!0,console.info("local peer id",this.localPeerId);try{const e=await s.joinSession(o,t);this.canJoinSession=e.ok}catch(n){console.error(n),this.unableToReachServer=!0}this.joinSessionLoading=!1,this.canJoinSession&&!this.unableToReachServer&&await this.askLocalStream()},errorCaptured(e){this.error=e},beforeDestroy(){console.info("beforeDestroy()"),this.peersManager&&this.peersManager.closeAllConnections()},methods:{finishInitialSetup(){this.isLocalPeerSetupReady=!0;const{params:{sessionName:e},query:{serverUrl:t}}=this.$route.params,o=new URL(t);o.protocol=window.location.protocol.replace("http","ws");const s=r["SOCKET_ROUTE"].replace("{sessionName}",e).replace("{peerId}",this.localPeerId);this.peersManager=new u({socketAPI:new r["SocketAPI"]({url:new URL(s,o).href,sessionName:this.$route.params.sessionName,peerId:this.localPeer}),localPeerId:this.localPeerId,localStream:this.localStream}),this.$nextTick(()=>{this.registerRemotePeersVideo(),this.$refs["local-peer-video"].srcObject=this.localStream}),this.$watch("peersManager.size",()=>{this.$nextTick(()=>this.registerRemotePeersVideo())})},registerRemotePeersVideo(){this.peersManager.peerConnections.forEach((e,t)=>{e.registerVideo(this.$refs[t])})},async askLocalStream(){const e={echoCancellation:!0,noiseSuppression:!0};this.localStream=await window.navigator.mediaDevices.getUserMedia({audio:e,video:e}),this.$refs["test-video"].srcObject=this.localStream}}},f=h,v=(o("0cf6"),o("2877")),m=Object(v["a"])(f,s,n,!1,null,null,null);t["default"]=m.exports},"85ec":function(e,t,o){},"90d1":function(e,t,o){},ca53:function(e,t,o){"use strict";var s=o("5654"),n=o.n(s);n.a},cd49:function(e,t,o){"use strict";o.r(t);var s=o("2b0e"),n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("div",{attrs:{id:"nav"}},[o("router-link",{attrs:{to:"/"}},[e._v("Home")])],1),e.$route.query.sessionName?e._e():o("Home"),e.$route.query.sessionName?o("Session"):e._e()],1)},r=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"home"},[s("img",{attrs:{alt:"Vue logo",src:o("cf05")}}),s("form",{staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[s("fieldset",[s("legend",[e._v(" Start a conference ")]),s("label",[e._v(" Server URL "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.serverUrl,expression:"serverUrl"}],attrs:{type:"url",required:""},domProps:{value:e.serverUrl},on:{input:function(t){t.target.composing||(e.serverUrl=t.target.value)}}})]),s("label",[e._v(" Session Name "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.sessionName,expression:"sessionName"}],staticClass:"text-input",attrs:{type:"text",required:""},domProps:{value:e.sessionName},on:{input:function(t){t.target.composing||(e.sessionName=t.target.value)}}})]),s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.sessionWithPassword,expression:"sessionWithPassword"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.sessionWithPassword)?e._i(e.sessionWithPassword,null)>-1:e.sessionWithPassword},on:{change:function(t){var o=e.sessionWithPassword,s=t.target,n=!!s.checked;if(Array.isArray(o)){var r=null,i=e._i(o,r);s.checked?i<0&&(e.sessionWithPassword=o.concat([r])):i>-1&&(e.sessionWithPassword=o.slice(0,i).concat(o.slice(i+1)))}else e.sessionWithPassword=n}}}),e._v(" Add a password ")]),e.sessionWithPassword?s("label",[e._v(" Password "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"text-input",attrs:{type:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]):e._e(),s("hr"),e._m(0)]),s("Modal",{attrs:{fixed:"",open:e.createSessionLoading||e.sessionExistsLoading},on:{close:e.resetForm},scopedSlots:e._u([{key:"header",fn:function(){return[s("h3",[e._v("Loading…")])]},proxy:!0},{key:"footer",fn:function(){return[s("p",{staticStyle:{"text-align":"center"}},[e._v("No actions")])]},proxy:!0}])},[e.sessionExistsLoading?s("p",[e._v("Checking if session is available")]):e._e(),e.createSessionLoading?s("p",[e._v("Creating session")]):e._e()]),s("Modal",{attrs:{fixed:"",open:e.sessionExists},on:{close:e.resetForm},scopedSlots:e._u([{key:"header",fn:function(){return[s("h3",[e._v("Sorry!")])]},proxy:!0}])},[s("p",[e._v("This section already exists")])]),s("Modal",{attrs:{fixed:"",open:!1===e.createdSessionSuccessfully},on:{close:e.resetForm},scopedSlots:e._u([{key:"header",fn:function(){return[s("h3",[e._v("Something went wrong")])]},proxy:!0}])},[s("p",[e._v("For an unknown reason, we were unable to create your session. Please try again.")]),s("p",[e._v("If the problem persists, maybe try a bit later. Sorry for the inconvenience.")])]),s("Modal",{attrs:{fixed:"",open:!0===e.unableToReachServer},on:{close:e.resetForm},scopedSlots:e._u([{key:"header",fn:function(){return[s("h3",[e._v("Oopsie…")])]},proxy:!0}])},[s("p",[e._v("It looks like the server is taking a nap, we can’t reach it… :/")])]),s("Modal",{attrs:{fixed:"",open:e.createdSessionSuccessfully},scopedSlots:e._u([{key:"header",fn:function(){return[s("h3",[e._v("Success !")])]},proxy:!0},e.sessionUrl?{key:"footer",fn:function(){return[s("button",{on:{click:function(t){e.$router.push(e.sessionUrl.href.replace(e.sessionUrl.origin,""))}}},[e._v("Let’s go !")])]},proxy:!0}:null],null,!0)},[e.sessionUrl?s("p",[e._v(" Copy the following link to share with your friends: "),s("input",{attrs:{type:"text"},domProps:{value:e.sessionUrl.href}})]):e._e()])],1)])},a=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"form-footer"},[o("button",{attrs:{type:"submit"}},[e._v("Submit")])])}],c=o("714b"),l=o("12fd"),d={name:"Home",components:{Modal:c["a"]},data:()=>({sessionName:"",sessionWithPassword:!1,password:"",serverUrl:"",sessionUrl:void 0,unableToReachServer:void 0,sessionExistsLoading:!1,sessionExists:void 0,createSessionLoading:!1,createdSessionSuccessfully:void 0}),methods:{async submit(){const e=new l["ServerAPI"]({url:new URL(this.serverUrl).origin});this.sessionExistsLoading=!0;try{const t=await e.sessionExists(this.sessionName);this.sessionExists=t.ok}catch(t){this.unableToReachServer=!0}if(this.sessionExistsLoading=!1,!this.unableToReachServer&&!this.sessionExists){this.createSessionLoading=!0;try{const t=await e.createSession(this.sessionName,this.password);this.createdSessionSuccessfully=t.ok,this.sessionUrl=new URL("/",window.location.origin),this.sessionUrl.searchParams.set("serverUrl",this.serverUrl),this.sessionUrl.searchParams.set("sessionName",this.sessionName),this.password&&this.sessionUrl.searchParams.set("password",this.password)}catch(t){this.unableToReachServer=!0}this.createSessionLoading=!1}},resetForm(){this.unableToReachServer=void 0,this.sessionUrl=void 0,this.sessionExistsLoading=!1,this.sessionExists=void 0,this.createSessionLoading=!1,this.createdSessionSuccessfully=void 0}}},u=d,p=(o("ca53"),o("2154"),o("2877")),h=Object(p["a"])(u,i,a,!1,null,"7b587502",null),f=h.exports,v=o("78b4"),m={name:"App",components:{Home:f,Session:v["default"]}},g=m,y=(o("034f"),Object(p["a"])(g,n,r,!1,null,null,null)),w=y.exports,S=o("9483");Object(S["a"])("/web-rtc-demo-app/dist/service-worker.js",{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var b=o("8c4f");s["a"].use(b["a"]);var _=[{path:"/",name:"Home",component:f},{path:"/sessions/:sessionName",name:"Session",component:function(){return Promise.resolve().then(o.bind(null,"78b4"))}}],P=new b["a"]({mode:"history",base:"/web-rtc-demo-app/dist/",routes:_}),k=P;s["a"].config.productionTip=!1,new s["a"]({router:k,render:function(e){return e(w)}}).$mount("#app")},cf05:function(e,t,o){e.exports=o.p+"img/logo.82b9c7a5.png"},ed34:function(e,t,o){}});
//# sourceMappingURL=app.2d3ab72e.js.map